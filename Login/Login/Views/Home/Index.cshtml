@{
    ViewBag.Title = "Home Page";
}


<div class="row">

    <div class="col-xl-2" style=" background-color:transparent">
        <p>Seleccione un distrito</p>
    </div>
    <div class="col-xl-5" style="background-color:transparent">
        <select name="distritos" id="distritos">
            <option value="0">-Elegir-</option>
            <option value="1">Distrito 1</option>
            <option value="2">Distrito 2</option>
            <option value="3">Distrito 3</option>
            <option value="4">Distrito 4</option>
            <option value="5">Distrito 5</option>
            <option value="6">Distrito 6</option>
            <option value="7">Distrito 7</option>
            <option value="8">Distrito 8</option>
            <option value="9">Distrito 9</option>
            <option value="10">Distrito 10</option>
            <option value="11">Distrito 11</option>
            <option value="12">Distrito 12</option>
            <option value="13">Distrito 13</option>
            <option value="14">Distrito 14</option>
            <option value="15">Distrito 15</option>
            <option value="16">Distrito 16</option>
            <option value="17">Distrito 17</option>
            <option value="18">Distrito 18</option>
            <option value="19">Distrito 19</option>
            <option value="20">Distrito 20</option>
            <option value="21">Distrito 21</option>
            <option value="22">Distrito 22</option>
            <option value="23">Distrito 23</option>
            <option value="24">Distrito 24</option>
            <option value="25">Distrito 25</option>
            <option value="26">Distrito 26</option>
            <option value="27">Distrito 27</option>
            <option value="28">Distrito 28</option>
        </select>
    </div>
    <div class="col-xl-7" style="background-color:transparent">
    </div>
</div>

<p id="texto"></p>
<table class="table" id="candidatosTable" style="width:100%;">
</table>
<input type="button" value="Resultados" id="Calcular">
<br>
<br>
<br>
<table id="resultado" style="width:100%">
</table>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        class Candidato {

            constructor(Nombre, Lista, Partido, Sigla, Distrito, Voto) {
                this.Nombre = Nombre;
                this.Lista = Lista;
                this.Partido = Partido;
                this.Sigla = Sigla;
                this.Distrito = Distrito;
                if (Voto == "") {
                    Voto = 0;
                }
                //parseInt("23", 10)
                this.Voto = parseInt(Voto, 10);
                //alert(Voto);
            }
        }

        class CandidatoFinal {

            constructor(Nombre, Lista, Partido, Sigla, Distrito, Voto, VotoLista, VotoFinal) {
                this.Candidato = new Candidato(Nombre, Lista, Partido, Sigla, Distrito, Voto);
                this.VotoLista = VotoLista;
                this.VotoFinal = VotoFinal;
                //alert(Voto);
            }
        }

        class Lista {

            constructor(Nombre, Votos, Candidatos) {
                this.Nombre = Nombre;
                this.Votos = Votos;
                this.Candidatos = Candidatos;
            }
        }

        var ListaCandidatos = [];
        var Listas = []; //array.indexOf(2)
        var ListaConCandidatos = [];
        var ListaFinal = [];
        /*Con esta función al seleccionar un valor en el DropdownList Tema se rellenará automaticamente
         * el DropdownList de subtemas con los subtemas relacionados al Tema seleccionado
        */

        $(document).ready(function () {
            $("#distritos").change(function () {
                //alert("Hola");
                $("#texto").empty();
                $("#texto").append("Llenar con resultados de prueba la columna Votos");
                $.get("/Home/GetCandidatos", { id: $("#distritos").val() }, function (data) {
                    // VACIAMOS EL DropDownList
                    $("#candidatosTable").empty();
                    // AÑADIMOS UN NUEVO label CON EL NOMBRE DEL ELEMENTO SELECCIONADO
                    //$("#candidatos").append("<option value> Seleccionar Subtemas de " + $("#distritos option:selected").text() + " --</option>")
                    $("#candidatosTable").append("<tr style='background-color:#FF685B'>" +
                        "<th> Nombre</th>" +
                        "<th>Lista</th>" +
                        "<th>Partido</th>" +
                        "<th>Sigla</th>" +
                        "<th>Distrito</th>" +
                        "<th>Votos</th>" +
                        "</tr > ")
                    // CONSTRUIMOS EL DropDownList A PARTIR DEL RESULTADO Json (data)
                    $.each(data, function (index, row) {
                        $("#candidatosTable").append("<tr>" +
                            "<td>" + row.NOMBRE + "</td>" +
                            "<td>" + row.LISTA + "</td>" +
                            "<td>" + row.PARTIDO + "</td>" +
                            "<td>" + row.PARTIDOCORTO + "</td>" +
                            "<td>" + row.DISTRITO + "</td>" +
                            "<td> <input id='numero' type='number' min='0'> </td>" +
                            "</tr>")
                    });
                });

            });
        });
       
        $(document).ready(function () {
            $("#Calcular").click(function () {
                ListaCandidatos = [];
                Listas = []; //array.indexOf(2)
                ListaConCandidatos = [];
                ListaFinal = [];
                var table = document.getElementById("candidatosTable");
                var indx = 0;

                for (var i = 1, row; row = table.rows[i]; i++) {
                    ListaCandidatos.push(new Candidato(row.cells[0].innerHTML, row.cells[1].innerHTML, row.cells[2].innerHTML, row.cells[3].innerHTML, row.cells[4].innerHTML, document.getElementsByTagName("input")[indx].value));

                    //alert(row.cells[0].innerHTML + row.cells[1].innerHTML + row.cells[2].innerHTML + row.cells[3].innerHTML + row.cells[4].innerHTML + document.getElementsByTagName("input")[indx].value)
                    if (Listas.indexOf(row.cells[1].innerHTML) == -1) {
                        Listas.push(row.cells[1].innerHTML);
                    }
                    indx++;
                    /*
                 for (var j = 0, col; col = row.cells[j]; j++)
                 {
                     //alert(col.innerHTML);
                 }
                 */
                }
                //alert(ListaCandidatos[0].Nombre);
                //alert(ListaCandidatos[0].Lista);
                //alert(ListaCandidatos[0].Partido);
                //alert(ListaCandidatos[0].Sigla);
                //alert(ListaCandidatos[0].Distrito);
                //alert(ListaCandidatos[0].Voto);

                //const found = ListaCandidatos.filter(element => element.Partido == "INDEPENDIENTES");
                //alert(found.length);

                //const array1 = [5, 12, 8, 130, 44];

                //const found = array1.filter(element => element > 10);
                //alert(found.length)
                //alert(Listas);
                var found;
                //var acumulador;
                for (var i = 0, fila; fila = Listas[i]; i++) {
                    var ListaAux = [];
                    //alert(ListaCandidatos[0].Partido);
                    found = ListaCandidatos.filter(element => element.Lista === fila);
                    //alert(fila);
                    var acumulador = 0;
                    for (var j = 0, fila2; fila2 = found[j]; j++) {
                        //alert(j)
                        //alert(fila2.Voto);
                        acumulador = acumulador + fila2.Voto;
                        //alert(acumulador)
                        ListaAux.push(fila2.Nombre)

                    }

                    ListaConCandidatos.push(new Lista(fila, acumulador, found.sort((a, b) => (a.Voto > b.Voto) ? -1 : 1)));
                }

                //alert(ListaConCandidatos[0].Nombre);
                //alert(ListaConCandidatos[0].Votos);
                //alert(ListaConCandidatos[0].Candidatos[0]);
                //alert(ListaAux[0].Nombre);
                //alert(ListaCandidatos.filter(element => element.Partido == ListaConCandidatos[0].Nombre)[0].Nombre);
                $("#resultado").empty();
                for (var i = 0, fila; fila = ListaConCandidatos.sort((a, b) => (a.Voto > b.Voto) ? -1 : 1)[i]; i++) {
                    for (var j = 0, fila2; fila2 = fila.Candidatos[j]; j++) {
                        //alert(fila2.Nombre)
                        //fila2.Voto = Math.round(fila.Votos / (j + 1));
                        ListaFinal.push(new CandidatoFinal(fila2.Nombre, fila2.Lista, fila2.Partido, fila2.Sigla, fila2.Distrito, fila2.Voto, fila.Votos, Math.round(fila.Votos / (j + 1))));
                    }
                }
          
                $("#resultado").append("<tr style='background-color:#FF685B'>" +
                    
                    "<th> Nombre</th>" +
                    "<th>Lista</th>" +
                    "<th>Votos</th>" +
                    "<th>Votos de la lista</th>" +
                    "<th>Votos asignados</th>" +
                    "</tr > ")
                for (var i = 0, fila; fila = ListaFinal.sort((a, b) => (a.VotoFinal > b.VotoFinal) ? -1 : 1)[i]; i++) {
                  
                    $("#resultado").append("<tr>" +
                        "<td>" + fila.Candidato.Nombre + "</td>" +
                        "<td>" + fila.Candidato.Lista + "</td>" +
                        "<td>" + fila.Candidato.Voto + "</td>" +
                        "<td>" + fila.VotoLista + "</td>" +
                        "<td>" + fila.VotoFinal + "</td>" +
                        /*
                        "<td>" + row.PARTIDOCORTO + "</td>" +
                        "<td>" + row.DISTRITO + "</td>" +
                        "<td> <input id='numero' type='number' min='0'> </td>" +
                        */
                        "</tr>");
                }
                /*
                var aux = new CandidatoFinal("Nombre", "Lista", "Partido", "Sigla", "Distrito", 2, 3, 4);
                alert(aux.Candidato.Nombre);
                alert(aux.Candidato.Sigla);
                alert(aux.Candidato.Voto);
                alert(aux.VotoLista);
                */
                //alert(parseInt("23", 10))
            });
        });
    </script>
}
